<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Package Handoff</title>
<!-- 2016-09-25 Sun 16:59 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Gaurish" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style>pre.src {background-color: #303030; color: #e5e5e5;} </style>
<style>pre.src {background-color: #303030; color: #e5e5e5;} </style>
<link rel="stylesheet" type="text/css" href="org-style.css"/>
<style> blockquote {background:#EEEEEE; padding: 3px 13px}</style>
<script type="text/javascript" src="org-info.js">
/**
 *
 * @source: org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Package Handoff</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Introduction</a></li>
<li><a href="#sec-2">2. Theory</a></li>
<li><a href="#sec-3">3. Experiments</a>
<ul>
<li><a href="#sec-3-1">3.1. Functional Specifications</a></li>
<li><a href="#sec-3-2">3.2. Source Code</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1. PackageHandoffPrelude.hs</a></li>
<li><a href="#sec-3-2-2">3.2.2. SinglePackageRouting.hs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
An interesting Euclidean Steiner-Tree like question was posed by Prof. Mitchell while discussing
a paper by Craig Tovey giving heuristics for transporting multiple packages from their sources
to destinations along a graph with \(r\) co-ordinating carrier robots.
</p>

<blockquote>
<p>
There are \(m\) mobile carrier-robots located initially at \(\{(x^{r}_j, y^{r}_j)\}_{j=1}^m \subseteq \mathbb{R}^2\).
For each \(j\), where \(1 \leq j \leq m\), robot \(r_j\) is able to move in any direction with a maximum speed \(v_j\).
If two robots meet at a point in the course of their motion, they can exchange an arbitrary number of
items they each carry. For simplicity, each of the \(m\) robots can be assumed to have infinite fuel and
an infinite weight-carrying capacity.
</p>

<p>
If you are given \(n\) stationary packages tagged \(p_1, p_2, \ldots p_n\) located respectively at
\(\{(x^{s}_i, y^{s}_i)\}_{i=1}^n\) all of which must get to their destinations \(\{(x^{t}_i, y^{t}_i)\}_{i=1}^n\)
using the \(m\) robots, how can you construct a schedule for the robots to transport
all packages to their destinations "quickly" ?
</p>
</blockquote>

<p>
Depending on the interpretation of "quick", we get different cost criteria. e.g. <i><b>min-sum</b></i>:
the sum of the travel times of the packages and <i><b>min-max</b></i>: the time required for the last package
to get to its destination.
</p>

<p>
A nice real world instance of this problem is one where a taxi-service must co-ordinate
its fleet of cabs to transport passengers located at different points on the map, to
their destinations.
</p>

<p>
Here are a few variants or special cases of the above problem that might be of indepenedent interest.
</p>

<ul class="org-ul">
<li>What if only one package needs to be transported i.e. \(n=1\) ? In this case, min-sum and
min-max yield the same cost function.
</li>
<li>What if \(n=1\) <i>and</i> the package must move along a straight-line from its source all the way
to its destination. This is also an interesting question for the multiple-robot case.
 i.e. all packages must move along a straight line from their origin to their destination.
</li>
<li>What if \(n=2\)?
</li>
<li>What if every robot could travel with the same maximum speed \(v_j=V\) but has only limited fuel.
Two additional sub-constraints might be of interest.
<ul class="org-ul">
<li>What if every robot is constrained to move back into its original position after it does
all its handoffs as required by the schedule.
</li>
<li>What if a robot is allowed to move only along the horizontal and vertical directions?
</li>
</ul>
</li>
<li>Is there a continuous version of this problem? By that I mean, could robots be thought of
as distributed uniformly throughout the domain?
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Theory</h2>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Experiments</h2>
<div class="outline-text-2" id="text-3">
<p>
I've created a Github repository, <b><a href="https://github.com/gtelang/packagehandoff">packagehandoff</a></b> ,which contains the Haskell code for experimenting
with various heuristics for solving package-handoff problems. That repository also contains a wiki 
containing a motley collection of checklists, todos, braindumps and notes-to-self being made while 
designing library.
</p>

<p>
The base of the code is similar to that of Pulleys and r-Gather in Python. 
Here I plan to principally use Haskell. Besides Haskell also some really interesting libraries like quickcheck, 
reactive-banana, gloss, Diagrams, lenses, the FGL and GSL bindings, the parallelism on offer and of course as 
a design langauge for algorithms using its type-system. Besides, gloss apparently performs extremely well under 
threading. 
</p>

<p>
The most important libraries for performing geometric computations will be
</p>
<ol class="org-ol">
<li>Reactive Banana
</li>
<li>CGAL (via C-wrappers)
</li>
<li>GSL  (via C-wrappers)
</li>
<li>Diagrams (for its computations): (it does have the left turn thing)
</li>
<li>Shewchuk's predicates (directly via the FFI)
</li>
<li>Cplex-interface (for optimization)
</li>
<li>GLPK-interface  (for linear programming)
</li>
<li>FGL (native Haskell), iGraph and the BGL( both with C bindings via FFI)
</li>
<li>GeoSteiner (C bindings via the FFI)
</li>
<li>Liquid-Haskell and the Dependent Types Extension (for stronger types)
</li>
</ol>

<p>
Different heuristics for both single and multi-package routine will be implemented atop the following interactive system
outline in the next section. 
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Functional Specifications</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Just like in the Pulley/rGathers codes, the events will be grouped into major <b>modes</b>:
</p>
<ul class="org-ul">
<li>Robot input
</li>
<li>Fuel input
</li>
<li>Package input
</li>
<li>Scheduling algorithm input
</li>
</ul>

<p>
<b>The current mode of the visualization thus becomes a state-variable!</b> By default, i.e
when you start the canvas for the first time around, it will be in robot input mode.
Modes will consist of an additive type!!! Key-presses <b><font color = "red">r, f, p, s</font></b> 
switches between them. <b>Within a mode, I will use the <font color = "red"> mouse buttons </font> to insert/modify data and <font color = "red"> Del </font> to delete data.</b> 
If you press <b><font color = "red"> X </font></b>, you can stop the animation, and clear whatever
"information" you have gathered about the algorithm. And finally, I will be using all of Diagrams' inbuilt data-types 
for things such as points, vectors, planes and other things. 
</p>

<p>
The schedule is calculated first and only then animated. 
</p>

<p>
Here is a very high-overview of how the code works. The state variable contains the state of the packages 
and robots. Three of <b>play</b>'s arguments are functions as shown by the arrows below. The whole simulation
can be thought of as a left-right infinite tiling of this diagram, where each tile corresponds to a point in time.
</p>



<div class="figure">
<p><img src="modes.png" alt="modes.png" />
</p>
</div>

<dl class="org-dl">
<dt> <font color = "blue">Robot Input mode</font> </dt><dd><ol class="org-ol">
<li>To enter press <b>r</b> and show this on the screen.
</li>
<li>The user inputs robot positions by moving a disk over the screen.
<ol class="org-ol">
<li>The <b>disk-center</b> correponds to where the robot will be placed.
</li>
<li>The <b>disk-radius</b>  corresponds to the maximum speed with which a robot can move.
</li>
</ol>
</li>
<li>Each disk is selectable and movable and deletable, and can be resized with the scroll wheel.
On being selected a disk changes color. Multiple disks can be selected and changed at the same time.
</li>
<li>A ticker at the top tells what the (speed) disk size is as you move the scroll wheel up
and down. The index of the robot is also displayed.
</li>
</ol>
</dd>

<dt> <font color = "blue"> Fuel input mode </font> </dt><dd><ol class="org-ol">
<li>To enter these, press <b>f</b>. Again disks are created, and their size correponds to the amount
of fuel that they have.
</li>
<li>While the robots are moving you should be able to press a key to see the amount of fuel remaining
Maybe  ahistogram can be shown on the side, with the fuel going down.
</li>
</ol>
</dd>

<dt> <font color = "blue"> Package input mode </font> </dt><dd><ol class="org-ol">
<li>To enter press <b>p</b> and show this on the screen
</li>
<li>Package, source and destination pairs are colored with the same color
But with a different boundary color. The source has a thick white boundary,
the target has a black boundary. All the faces will be transluscent so that we can
visualize multiple circles at a particular point.
</li>
<li>When you click at a point on the screen in input mode, you get both the
source and target paired as an arrow: source is the tail, and target is the tip.
The tip and tail of this arrow can be moved around.
</li>
<li>The sources and targets of the arrows are selectable and deletable but with an
important twist!! Whenever you select, s or t, you can see a light pink arrow
stretching from the source to its target, with a little piece of text on top
of the middle of the arrow indicating the length. This length changes  dynamically
as we change the positions of the source and target.
</li>
<li>Deleting the source and or target, deletes the entire arrow.
</li>
</ol>
</dd>

<dt> <font color = "blue">  Choose Scheduling Algorithm </font> </dt><dd><ol class="org-ol">
<li>To enter press <b>a</b> followed by a number corresponding to the algorithm.
The list of algorithms is displayed to the terminal. Everything will
be managed with the play function. 
</li>
<li>The schedule is computed offline and then rendered. 
<ul class="org-ul">
<li>statically   
</li>
<li>dynamically
</li>
</ul>
<p>
Both can be supported with call-backs. 
Suppose you are doing algorithm 1 for problem X
Then, doing
    a   (for algorithm mode) 
    1   (algorithm number) 
    s/d (for static or dynamic animation of the schedule after being computed offline)
</p>
</li>

<li>Every algorithm has its own .hs file. Inside this .hs file, you will need to provide 
implementations of the other two arrows "<b>Render World</b>" and "<b>Handle Events</b>" you see in the diagram above. 
</li>

<li>Because of the stupid gloss problem (but see <a href="http://stackoverflow.com/a/39622163/505306">this</a>!), <b>you will have to do the animation last</b>. Once you compute 
the schedule, you should also write out a YAML file containing the schedule. The YAML file 
will have a very similar nesting to the record file, and hence will be useful by itself also
After writing out the file, start the animation. 
</li>
</ol>
</dd>
</dl>

<p>
The layout of the code files will be as follows:
</p>

<dl class="org-dl">
<dt> Main.hs </dt><dd>All setup, profiling work goes here, when your program starts
maturing, start having independent org files for the main.hs files
which setup different sorts of experiments. This imports algorithmX
and calls it via play in addition to any other profiling steps.
</dd>
<dt> ProbX.hs </dt><dd>Implementation of the arrows <b>Render World</b>, <b>Step World</b>, <b>Handle Events</b> 
for problemX in Figure 1. Try to export as little as possible. Just 
the arrows, and State should be sufficient. Other helper functions 
will not be needed for export. All algorithms to solve variant X of the package 
hand-off problem goes into <b>probX.hs</b>. Every problem will have its own 
customized game-state, input interaction, and algorithms to solve/approximate it. 
Every probX variant gets its own section in this Org file. Thus different variants 
are kept independent of each other.

<p>
Since all algorithms will be coded in literate-style, you will not need to have too many
files to partition your code. This literate document weaves all those files and code-blocks 
together.
</p>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Source Code</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Each subsection here describes the source-code inside the file given by the subsection heading. 
</p>
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> PackageHandoffPrelude.hs</h4>
<div class="outline-text-4" id="text-3-2-1">

<p>
<b>PackageHandoffPrelude.hs</b> contains data-structures and routines common to all package-handoff 
variants. This section describes the code therein. First, import necessary libraries and make 
some descriptive type-synonyms. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ff9966;">-- | Common Data-Structures and Functions.</span>

<span style="color: #0000ff; font-weight: bold;">{-# LANGUAGE NoMonomorphismRestriction #-}</span>
<span style="color: #00ffff; font-weight: bold;">module</span> <span style="color: #00ff00;">PackageHandoffPrelude</span> <span style="color: #00ffff; font-weight: bold;">where</span>
<span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Diagrams.Prelude</span>
<span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ffff; font-weight: bold;">qualified</span> <span style="color: #00ff00;">Data.Map</span> <span style="color: #00ffff; font-weight: bold;">as</span> <span style="color: #00ff00;">Map</span>
<span style="color: #808080; font-style: italic;">-- </span><span style="color: #cc9393;">TODO</span><span style="color: #808080; font-style: italic;">: Use Liquid Haskell to enforce &#8805; 0 at the type level</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">Speed</span>    <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Double</span> <span style="color: #ff9966;">-- | &#8805; 0</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">Fuel</span>     <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Double</span> <span style="color: #ff9966;">-- | &#8805; 0</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">Time</span>     <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Double</span> <span style="color: #ff9966;">-- | &#8805; 0</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">PkgIndex</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Int</span>    <span style="color: #ff9966;">-- | &#8805; 0</span>
</pre>
</div>

<p>
The <b>Robot</b> data-type stores information about a single robot such as its positions at time \(t=0\)
maximum speed, fuel capacity and other input-data. 
</p>
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">Robot</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Robot</span> <span style="color: #707183;">{</span> initPosition <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Point</span> <span style="color: #00ff00;">V2</span> <span style="color: #00ff00;">Double</span><span style="color: #ffff00;">,</span> 
                     maxSpeed     <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Speed</span>          <span style="color: #ffff00;">,</span>
                     maxFuel      <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Fuel</span> 
                    <span style="color: #707183;">}</span> <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
The <b>Package</b> data-type stores the Cartesian co-ordinates of the <b>source</b> and <b>target</b> points 
of a package.
</p>
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">Package</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Package</span> <span style="color: #707183;">{</span> source <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Point</span> <span style="color: #00ff00;">V2</span> <span style="color: #00ff00;">Double</span><span style="color: #ffff00;">,</span>
                         target <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Point</span> <span style="color: #00ff00;">V2</span> <span style="color: #00ff00;">Double</span> 
                       <span style="color: #707183;">}</span> <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
The <b>World</b> data-type stores information about the robots and packages obtained from 
input source (e.g. the Gloss canvas or a YAML file)  
</p>
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">World</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">World</span> <span style="color: #707183;">{</span> robots      <span style="color: #ffff00;">::</span> <span style="color: #7388d6;">[</span><span style="color: #00ff00;">Robot</span><span style="color: #7388d6;">]</span>  <span style="color: #ffff00;">,</span>    
                     packages    <span style="color: #ffff00;">::</span> <span style="color: #7388d6;">[</span><span style="color: #00ff00;">Package</span><span style="color: #7388d6;">]</span>    
                   <span style="color: #707183;">}</span> <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Note that <b>World</b> knows <span class="underline">nothing</span> about the input source from which it came: 
it might have been a file, or it could have been inserted via a Gloss or a Diagrams canvas.  
Keeping the algorithmic and the input/output codes strictly decoupled is essential for making 
the code more modular. 
</p>

<p>
It also doesn't know anything about the time on the clock. <i>That</i> clocking will be taken care 
by a wrapper data-structure used by the visualization/animation routines of diagrams or gloss.
</p>
</div>

<ol class="org-ol"><li><a id="sec-3-2-1-1" name="sec-3-2-1-1"></a><b><span class="underline">Gloss Canvas IO</span></b><br  /><div class="outline-text-5" id="text-3-2-1-1">
<p>
Now we will need to connect the world to a Gloss canvas. The following data-structures
will be used by event-handlers which themselves are wrappers around the algorithmic code. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ff9966;">-- | State of the Gloss canvas</span>
<span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">GlossCanvas</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">GlossCanvas</span><span style="color: #707183;">{</span> currentMode <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Mode</span><span style="color: #ffff00;">,</span> 
                                world       <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">World</span><span style="color: #ffff00;">,</span> 
                                schedule    <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Schedule</span>
                              <span style="color: #707183;">}</span> <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
<b>Mode</b> in the snippet above refers to the following type. The GlossCanvas is always in one of four states(modes) 
described in the <b>Mode</b> data-type above. Depending on the current mode of the canvas, it responds differently to 
mouse and key-press events. To switch between the 4 modes use the <b>r,f,p,a</b> keys. To clear the canvas and reset the 
world state to empty, use <b>X</b> (Note the caps)
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ff9966;">-- | The Gloss Canvas is always in one of four modes</span>
 <span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">Mode</span> <span style="color: #ffff00;">=</span>   <span style="color: #00ff00;">RobotInput</span>    <span style="color: #ff9966;">-- ^ Insert Robots onto Canvas        'r </span>
             <span style="color: #ffff00;">|</span> <span style="color: #00ff00;">FuelInput</span>     <span style="color: #ff9966;">-- ^ Adjust the fuel for each robot.  'f'</span>
             <span style="color: #ffff00;">|</span> <span style="color: #00ff00;">PackageInput</span>  <span style="color: #ff9966;">-- ^ Insert Packages onto the Canvas. 'p'</span>
             <span style="color: #ffff00;">|</span> <span style="color: #00ff00;">AlgoInput</span>     <span style="color: #ff9966;">-- ^ Choose scheduling algorithm.     'a'</span>
             <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #ffff00;">,</span> <span style="color: #00ff00;">Eq</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Each robot will travel along a <span class="underline">piece-wise linear</span> curve, its vertices being sources/destinations of the packages 
and the rendezvous points where package-handoffs must occur. With that in mind, it is natural to represent the route 
for a single robot, as a <b>Trajectory</b>, which is a collection of <b>Link</b>'s and the global schedule being a collection 
of <b>Trajectory</b> s. Each <b>Link</b> is like a arrow in \(\mathbb{R}^2\) tagged data such as which packages travelled along 
that link, and a description of the package-exchanges that must take place at the link's <b>head</b>. 
</p>

<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #ff9966;">-- | Schedule for a single robot.</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">Trajectory</span>  <span style="color: #ffff00;">=</span> <span style="color: #707183;">[</span> <span style="color: #00ff00;">Link</span> <span style="color: #707183;">]</span> 

<span style="color: #ff9966;">-- | Schedule for a collection of robots</span>
<span style="color: #00ffff; font-weight: bold;">type</span> <span style="color: #00ff00;">Schedule</span>    <span style="color: #ffff00;">=</span> <span style="color: #707183;">[</span> <span style="color: #00ff00;">Trajectory</span> <span style="color: #707183;">]</span> 

<span style="color: #ff9966;">-- | An element of a trajectory</span>
<span style="color: #00ffff; font-weight: bold;">data</span> <span style="color: #00ff00;">Link</span> <span style="color: #ffff00;">=</span> <span style="color: #00ff00;">Link</span> 
           <span style="color: #707183;">{</span> head <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Point</span> <span style="color: #00ff00;">V2</span> <span style="color: #00ff00;">Double</span>         <span style="color: #ffff00;">,</span> <span style="color: #ff9966;">-- ^ Rendezvous or pick-up point </span>
             waitTime          <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Time</span>       ,<span style="color: #ff9966;">-- ^ Time of waiting at the head</span>
             inTransitPackages <span style="color: #ffff00;">::</span> <span style="color: #7388d6;">[</span><span style="color: #00ff00;">PkgIndex</span><span style="color: #7388d6;">]</span> ,<span style="color: #ff9966;">-- ^ List of packages carried while moving to head</span>
             givePackagesTo    <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Map.Map</span> <span style="color: #00ff00;">PkgIndex</span> <span style="color: #7388d6;">[</span><span style="color: #00ff00;">PkgIndex</span><span style="color: #7388d6;">]</span>,<span style="color: #ff9966;">-- ^ Give packages to specified robots </span>
             takePackagesFrom  <span style="color: #ffff00;">::</span> <span style="color: #00ff00;">Map.Map</span> <span style="color: #00ff00;">PkgIndex</span> <span style="color: #7388d6;">[</span><span style="color: #00ff00;">PkgIndex</span><span style="color: #7388d6;">]</span> <span style="color: #ff9966;">-- ^ Take packages from specified robots</span>
            <span style="color: #707183;">}</span> <span style="color: #00ffff; font-weight: bold;">deriving</span> <span style="color: #707183;">(</span><span style="color: #00ff00;">Show</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-3-2-1-2" name="sec-3-2-1-2"></a><b><span class="underline">Disk File IO</span></b><br  /></li></ol>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> SinglePackageRouting.hs</h4>
<div class="outline-text-4" id="text-3-2-2">
<div class="org-src-container">

<pre class="src src-haskell"><span style="color: #0000ff; font-weight: bold;">{-# LANGUAGE UnicodeSyntax #-}</span>
<span style="color: #0000ff; font-weight: bold;">{-# LANGUAGE NoMonomorphismRestriction #-}</span>

 <span style="color: #ff9966;">{- | This module contains scheduling algorithms and data-structures for </span>
<span style="color: #ff9966;">      routing a single package from point A to point B, where the carrier-</span>
<span style="color: #ff9966;">      robots have varying velocity and possibly limited fuel.</span>
<span style="color: #ff9966;"> -}</span>

 <span style="color: #00ffff; font-weight: bold;">module</span> <span style="color: #00ff00;">SinglePackageRouting</span> <span style="color: #00ffff; font-weight: bold;">where</span>

 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Diagrams.Prelude</span>

 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ffff; font-weight: bold;">qualified</span> <span style="color: #00ff00;">Data.List</span> <span style="color: #00ffff; font-weight: bold;">as</span> <span style="color: #00ff00;">List</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ffff; font-weight: bold;">qualified</span> <span style="color: #00ff00;">Data.Map</span>  <span style="color: #00ffff; font-weight: bold;">as</span> <span style="color: #00ff00;">Map</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ffff; font-weight: bold;">qualified</span> <span style="color: #00ff00;">Data.Set</span>  <span style="color: #00ffff; font-weight: bold;">as</span> <span style="color: #00ff00;">Set</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ffff; font-weight: bold;">qualified</span> <span style="color: #00ff00;">Data.Function</span> <span style="color: #00ffff; font-weight: bold;">as</span> <span style="color: #00ff00;">Function</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Control.Monad</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Data.Monoid</span> 

 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Data.Colour.Palette.BrewerSet</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Graphics.Gloss</span>
 <span style="color: #00ffff; font-weight: bold;">import</span> <span style="color: #00ff00;">Graphics.Gloss.Interface.Pure.Game</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Gaurish</p>
<p class="date">Created: 2016-09-25 Sun 16:59</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
