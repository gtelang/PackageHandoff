<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-----------------------------------------------------------------------------
    reactive-banana
------------------------------------------------------------------------------}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RecursiveDo #-}</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-comment">-- * Synopsis</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-comment">-- | This is an internal module, useful if you want to</span><span>
</span><a name="line-8"></a><span>    </span><span class="hs-comment">-- implemented your own FRP library.</span><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- If you just want to use FRP in your project,</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-comment">-- have a look at &quot;Reactive.Banana&quot; instead.</span><span>
</span><a name="line-11"></a><span>    </span><span>
</span><a name="line-12"></a><span>    </span><span class="hs-comment">-- * Evaluation</span><span>
</span><a name="line-13"></a><span>    </span><a href="Reactive.Banana.Prim.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Types.html#Network"><span class="hs-identifier hs-type">Network</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Types.html#emptyNetwork"><span class="hs-identifier hs-var">emptyNetwork</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-comment">-- * Build FRP networks</span><span>
</span><a name="line-16"></a><span>    </span><a href="Reactive.Banana.Prim.Types.html#Build"><span class="hs-identifier hs-type">Build</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#liftIOLater"><span class="hs-identifier hs-var">liftIOLater</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Types.html#BuildIO"><span class="hs-identifier hs-type">BuildIO</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#liftBuild"><span class="hs-identifier hs-var">liftBuild</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#buildLater"><span class="hs-identifier hs-var">buildLater</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#buildLaterReadNow"><span class="hs-identifier hs-var">buildLaterReadNow</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Compile.html#compile"><span class="hs-identifier hs-var">compile</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Caching</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Cached</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-comment">-- * Testing</span><span>
</span><a name="line-23"></a><span>    </span><a href="Reactive.Banana.Prim.Compile.html#interpret"><span class="hs-identifier hs-var">interpret</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Compile.html#mapAccumM"><span class="hs-identifier hs-var">mapAccumM</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Compile.html#mapAccumM_"><span class="hs-identifier hs-var">mapAccumM_</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Compile.html#runSpaceProfile"><span class="hs-identifier hs-var">runSpaceProfile</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- * IO</span><span>
</span><a name="line-26"></a><span>    </span><a href="Reactive.Banana.Prim.IO.html#newInput"><span class="hs-identifier hs-var">newInput</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.IO.html#addHandler"><span class="hs-identifier hs-var">addHandler</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.IO.html#readLatch"><span class="hs-identifier hs-var">readLatch</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- * Pulse</span><span>
</span><a name="line-29"></a><span>    </span><a href="Reactive.Banana.Prim.Types.html#Pulse"><span class="hs-identifier hs-type">Pulse</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="Reactive.Banana.Prim.Plumbing.html#neverP"><span class="hs-identifier hs-var">neverP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#alwaysP"><span class="hs-identifier hs-var">alwaysP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#mapP"><span class="hs-identifier hs-var">mapP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Types.html#Future"><span class="hs-identifier hs-type">Future</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#tagFuture"><span class="hs-identifier hs-var">tagFuture</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#unsafeMapIOP"><span class="hs-identifier hs-var">unsafeMapIOP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#filterJustP"><span class="hs-identifier hs-var">filterJustP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#unionWithP"><span class="hs-identifier hs-var">unionWithP</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><span>
</span><a name="line-32"></a><span>    </span><span class="hs-comment">-- * Latch</span><span>
</span><a name="line-33"></a><span>    </span><a href="Reactive.Banana.Prim.Types.html#Latch"><span class="hs-identifier hs-type">Latch</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="Reactive.Banana.Prim.Combinators.html#pureL"><span class="hs-identifier hs-var">pureL</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#applyL"><span class="hs-identifier hs-var">applyL</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#accumL"><span class="hs-identifier hs-var">accumL</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#applyP"><span class="hs-identifier hs-var">applyP</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>    </span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- * Dynamic event switching</span><span>
</span><a name="line-37"></a><span>    </span><a href="Reactive.Banana.Prim.Combinators.html#switchL"><span class="hs-identifier hs-var">switchL</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#executeP"><span class="hs-identifier hs-var">executeP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#switchP"><span class="hs-identifier hs-var">switchP</span></a><span>
</span><a name="line-38"></a><span>    </span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-comment">-- * Notes</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- $recursion</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.Cached.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Cached</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Combinators</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.Compile.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Compile</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.IO.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Plumbing</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Prim.Plumbing.html#neverP"><span class="hs-identifier hs-var">neverP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#alwaysP"><span class="hs-identifier hs-var">alwaysP</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#liftBuild"><span class="hs-identifier hs-var">liftBuild</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#buildLater"><span class="hs-identifier hs-var">buildLater</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#buildLaterReadNow"><span class="hs-identifier hs-var">buildLaterReadNow</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#liftIOLater"><span class="hs-identifier hs-var">liftIOLater</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Reactive.Banana.Prim.Types.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Notes
------------------------------------------------------------------------------}</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- Note [Recursion]</span><span>
</span><a name="line-56"></a><span class="hs-comment">{- $recursion

The 'Build' monad is an instance of 'MonadFix' and supports value recursion.
However, it is built on top of the 'IO' monad, so the recursion is
somewhat limited.

The main rule for value recursion in the 'IO' monad is that the action
to be performed must be known in advance. For instance, the following snippet
will not work, because 'putStrLn' cannot complete its action without
inspecting @x@, which is not defined until later.

&gt;   mdo
&gt;       putStrLn x
&gt;       let x = &quot;Hello recursion&quot;

On the other hand, whenever the sequence of 'IO' actions can be known
before inspecting any later arguments, the recursion works.
For instance the snippet

&gt;   mdo
&gt;       p1 &lt;- mapP p2
&gt;       p2 &lt;- neverP
&gt;       return p1

works because 'mapP' does not inspect its argument. In other words,
a call @p1 &lt;- mapP undefined@ would perform the same sequence of 'IO' actions.
(Internally, it essentially calls 'newIORef'.)

With this issue in mind, almost all operations that build 'Latch'
and 'Pulse' values have been carefully implemented to not inspect
their arguments.
In conjunction with the 'Cached' mechanism for observable sharing,
this allows us to build combinators that can be used recursively.
One notable exception is the 'readLatch' function, which must
inspect its argument in order to be able to read its value.

-}</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">test</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Prim.Types.html#Build"><span class="hs-identifier hs-type">Build</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Prim.Types.html#Pulse"><span class="hs-identifier hs-type">Pulse</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><a name="test"><a href="Reactive.Banana.Prim.html#test"><span class="hs-identifier">test</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><a name="line-96"></a><span>    </span><a name="local-1627447931"><a href="#local-1627447931"><span class="hs-identifier">p1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Prim.Combinators.html#mapP"><span class="hs-identifier hs-var">mapP</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447932"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-97"></a><span>    </span><a name="local-1627447932"><a href="#local-1627447932"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Prim.Plumbing.html#neverP"><span class="hs-identifier hs-var">neverP</span></a><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627447931"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- Note [LatchStrictness]</span><span>
</span><a name="line-101"></a><span class="hs-comment">{-

Any value that is stored in the graph over a longer
period of time must be stored in WHNF.

This implies that the values in a latch must be forced to WHNF
when storing them. That doesn't have to be immediately
since we are tying a knot, but it definitely has to be done
before  evaluateGraph  is done.

It also implies that reading a value from a latch must
be forced to WHNF before storing it again, so that we don't
carry around the old collection of latch values.
This is particularly relevant for `applyL`.

Conversely, since latches are the only way to store values over time,
this is enough to guarantee that there are no space leaks in this regard.

-}</span><span>
</span><a name="line-120"></a></pre></body></html>