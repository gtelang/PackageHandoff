<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-----------------------------------------------------------------------------
    reactive-banana
------------------------------------------------------------------------------}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE Rank2Types #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Frameworks</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-comment">-- * Synopsis</span><span>
</span><a name="line-8"></a><span>    </span><span class="hs-comment">-- | Connect to the outside world by building 'EventNetwork's</span><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- and running them.</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-comment">-- * Simple use</span><span>
</span><a name="line-12"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#interpretAsHandler"><span class="hs-identifier hs-var">interpretAsHandler</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-comment">-- * Overview</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-comment">-- $build</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- * Building event networks with input/output</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-comment">-- ** Core functions</span><span>
</span><a name="line-19"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#compile"><span class="hs-identifier hs-var">compile</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Event</span><span class="hs-operator">.</span><span class="hs-identifier">Handler</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier hs-var">fromAddHandler</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromChanges"><span class="hs-identifier hs-var">fromChanges</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromPoll"><span class="hs-identifier hs-var">fromPoll</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#reactimate"><span class="hs-identifier hs-var">reactimate</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#Future"><span class="hs-identifier hs-type">Future</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#reactimate%27"><span class="hs-identifier hs-var">reactimate'</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#changes"><span class="hs-identifier hs-var">changes</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- $changes</span><span>
</span><a name="line-25"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#imposeChanges"><span class="hs-identifier hs-var">imposeChanges</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#execute"><span class="hs-identifier hs-var">execute</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#liftIOLater"><span class="hs-identifier hs-var">liftIOLater</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- $liftIO</span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-comment">-- ** Utility functions</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- | This section collects a few convience functions</span><span>
</span><a name="line-32"></a><span>    </span><span class="hs-comment">-- built from the core functions.</span><span>
</span><a name="line-33"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#interpretFrameworks"><span class="hs-identifier hs-var">interpretFrameworks</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#newEvent"><span class="hs-identifier hs-var">newEvent</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#mapEventIO"><span class="hs-identifier hs-var">mapEventIO</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#newBehavior"><span class="hs-identifier hs-var">newBehavior</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Running event networks</span><span>
</span><a name="line-36"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#EventNetwork"><span class="hs-identifier hs-type">EventNetwork</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#actuate"><span class="hs-identifier hs-var">actuate</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Frameworks.html#pause"><span class="hs-identifier hs-var">pause</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><a href="Control.Event.Handler.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Event</span><span class="hs-operator">.</span><span class="hs-identifier">Handler</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="Reactive.Banana.Combinators.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Combinators</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Combinators</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Prim</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><a href="Reactive.Banana.Types.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Documentation
------------------------------------------------------------------------------}</span><span>
</span><a name="line-52"></a><span class="hs-comment">{-$build

After having read all about 'Event's and 'Behavior's,
you want to hook them up to an existing event-based framework,
like @wxHaskell@ or @Gtk2Hs@.
How do you do that?

The module presented here allows you to

* obtain /input/ events from external sources and to

* perform /output/ in reaction to events.

In contrast, the functions from &quot;Reactive.Banana.Combinators&quot; allow you
to express the output events in terms of the input events.
This expression is called an /event graph/.

An /event network/ is an event graph together with inputs and outputs.
To build an event network,
describe the inputs, outputs and event graph in the
'MomentIO' monad
and use the 'compile' function to obtain an event network from that.

To /activate/ an event network, use the 'actuate' function.
The network will register its input event handlers and start
producing output.

A typical setup looks like this:

&gt; main = do
&gt;   -- initialize your GUI framework
&gt;   window &lt;- newWindow
&gt;   ...
&gt;
&gt;   -- describe the event network
&gt;   let networkDescription :: MomentIO ()
&gt;       networkDescription = do
&gt;           -- input: obtain  Event  from functions that register event handlers
&gt;           emouse    &lt;- fromAddHandler $ registerMouseEvent window
&gt;           ekeyboard &lt;- fromAddHandler $ registerKeyEvent window
&gt;           -- input: obtain  Behavior  from changes
&gt;           btext     &lt;- fromChanges    &quot;&quot; $ registerTextChange editBox
&gt;           -- input: obtain  Behavior  from mutable data by polling
&gt;           bdie      &lt;- fromPoll       $ randomRIO (1,6)
&gt;
&gt;           -- express event graph
&gt;           behavior1 &lt;- accumB ...
&gt;           let
&gt;               ...
&gt;               event15 = union event13 event14
&gt;
&gt;           -- output: animate some event occurrences
&gt;           reactimate $ fmap print event15
&gt;           reactimate $ fmap drawCircle eventCircle
&gt;
&gt;   -- compile network description into a network
&gt;   network &lt;- compile networkDescription
&gt;   -- register handlers and start producing outputs
&gt;   actuate network

In short,

* Use 'fromAddHandler' to obtain /input/ events.
The library uses this to register event handlers with your event-based framework.

* Use 'reactimate' to animate /output/ events.

* Use 'compile' to put everything together in an 'EventNetwork's
and use 'actuate' to start handling events.

-}</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Combinators
------------------------------------------------------------------------------}</span><span>
</span><a name="line-127"></a><span class="hs-comment">{- | Output.
Execute the 'IO' action whenever the event occurs.


Note: If two events occur very close to each other,
there is no guarantee that the @reactimate@s for one
event will have finished before the ones for the next event start executing.
This does /not/ affect the values of events and behaviors,
it only means that the @reactimate@ for different events may interleave.
Fortunately, this is a very rare occurrence, and only happens if

* you call an event handler from inside 'reactimate',

* or you use concurrency.

In these cases, the @reactimate@s follow the control flow
of your event-based framework.

Note: An event network essentially behaves like a single,
huge callback function. The 'IO' action are not run in a separate thread.
The callback function will throw an exception if one of your 'IO' actions
does so as well.
Your event-based framework will have to handle this situation.

-}</span><span>
</span><a name="line-152"></a><span class="hs-identifier">reactimate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-153"></a><a name="reactimate"><a href="Reactive.Banana.Frameworks.html#reactimate"><span class="hs-identifier">reactimate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#addReactimate"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addReactimate</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- | Output.</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- Execute the 'IO' action whenever the event occurs.</span><span>
</span><a name="line-157"></a><span class="hs-comment">--</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- This version of 'reactimate' can deal with values obtained</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- from the 'changes' function.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">reactimate'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Future"><span class="hs-identifier hs-type">Future</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><a name="reactimate%27"><a href="Reactive.Banana.Frameworks.html#reactimate%27"><span class="hs-identifier">reactimate'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#addReactimate"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">addReactimate</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-identifier">unF</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Input,</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- obtain an 'Event' from an 'AddHandler'.</span><span>
</span><a name="line-166"></a><span class="hs-comment">--</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- When the event network is actuated,</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- this will register a callback function such that</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- an event will occur whenever the callback function is called.</span><span>
</span><a name="line-170"></a><span class="hs-identifier">fromAddHandler</span><span> </span><span class="hs-glyph">::</span><a href="Control.Event.Handler.html#AddHandler"><span class="hs-identifier hs-type">AddHandler</span></a><span> </span><a href="#local-1627453067"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453067"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><a name="fromAddHandler"><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier">fromAddHandler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#fromAddHandler"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromAddHandler</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | Input,</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- obtain a 'Behavior' by frequently polling mutable data, like the current time.</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- The resulting 'Behavior' will be updated on whenever the event</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- network processes an input event.</span><span>
</span><a name="line-178"></a><span class="hs-comment">--</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- This function is occasionally useful, but</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- the recommended way to obtain 'Behaviors' is by using 'fromChanges'.</span><span>
</span><a name="line-181"></a><span class="hs-comment">--</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- Ideally, the argument IO action just polls a mutable variable,</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- it should not perform expensive computations.</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- Neither should its side effects affect the event network significantly.</span><span>
</span><a name="line-185"></a><span class="hs-identifier">fromPoll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627453066"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453066"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><a name="fromPoll"><a href="Reactive.Banana.Frameworks.html#fromPoll"><span class="hs-identifier">fromPoll</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#fromPoll"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromPoll</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Input,</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- obtain a 'Behavior' from an 'AddHandler' that notifies changes.</span><span>
</span><a name="line-190"></a><span class="hs-comment">--</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- This is essentially just an application of the 'stepper' combinator.</span><span>
</span><a name="line-192"></a><span class="hs-identifier">fromChanges</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627453065"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Event.Handler.html#AddHandler"><span class="hs-identifier hs-type">AddHandler</span></a><span> </span><a href="#local-1627453065"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453065"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><a name="fromChanges"><a href="Reactive.Banana.Frameworks.html#fromChanges"><span class="hs-identifier">fromChanges</span></a></a><span> </span><a name="local-1627453068"><a href="#local-1627453068"><span class="hs-identifier">initial</span></a></a><span> </span><a name="local-1627453069"><a href="#local-1627453069"><span class="hs-identifier">changes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-194"></a><span>    </span><a name="local-1627453070"><a href="#local-1627453070"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier hs-var">fromAddHandler</span></a><span> </span><a href="#local-1627453069"><span class="hs-identifier hs-var">changes</span></a><span>
</span><a name="line-195"></a><span>    </span><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627453068"><span class="hs-identifier hs-var">initial</span></a><span> </span><a href="#local-1627453070"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- | Output,</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- return an 'Event' that is adapted to the changes of a 'Behavior'.</span><span>
</span><a name="line-199"></a><span class="hs-comment">--</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- Remember that semantically, a 'Behavior' is a function @Behavior a = Time -&gt; a@.</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- This means that a Behavior does not have a notion of \&quot;changes\&quot; associated with it.</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- For instance, the following Behaviors are equal:</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- &gt; stepper 0 []</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- &gt; = stepper 0 [(time1, 0), (time2, 0)]</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- &gt; = stepper 0 $ zip [time1,time2..] (repeat 0)</span><span>
</span><a name="line-207"></a><span class="hs-comment">--</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- In principle, to perform IO actions with the value of a Behavior,</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- one has to sample it using an 'Event' and the 'apply' function.</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- However, in practice, Behaviors are usually step functions.</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- For reasons of efficiency, the library provides a way</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- to obtain an Event that /mostly/ coincides with the steps of a Behavior,</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- so that sampling is only done at a few select points in time.</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- The idea is that</span><span>
</span><a name="line-216"></a><span class="hs-comment">--</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- &gt; changes =&lt;&lt; stepper x e  =  return e</span><span>
</span><a name="line-218"></a><span class="hs-comment">--</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- Please use 'changes' only in a ways that do /not/ distinguish</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- between the different expressions for the same Behavior above.</span><span>
</span><a name="line-221"></a><span class="hs-comment">--</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- Note that the value of the event is actually the /new/ value,</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- i.e. that value slightly after this point in time. (See the documentation of 'stepper').</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- This is more convenient.</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- However, the value will not become available until after event processing is complete;</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- this is indicated by the type 'Future'.</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- It can be used only in the context of 'reactimate''.</span><span>
</span><a name="line-228"></a><span class="hs-identifier">changes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453064"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Future"><span class="hs-identifier hs-type">Future</span></a><span> </span><a href="#local-1627453064"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><a name="changes"><a href="Reactive.Banana.Frameworks.html#changes"><span class="hs-identifier">changes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><a href="Reactive.Banana.Types.html#F"><span class="hs-identifier hs-var">F</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#changesB"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">changesB</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unB</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">{- $changes

Note: If you need a variant of the 'changes' function that does /not/
have the additional 'Future' type, then the following code snippet
may be useful:

&gt; plainChanges :: Behavior a -&gt; MomentIO (Event a)
&gt; plainChanges b = do
&gt;     (e, handle) &lt;- newEvent
&gt;     eb &lt;- changes b
&gt;     reactimate' $ (fmap handle) &lt;$&gt; eb
&gt;     return e

However, this approach is not recommended, because the result 'Event'
will occur /slightly/ later than the event returned by 'changes'.
In fact, there is no guarantee whatsoever about what /slightly/ means
in this context. Still, it is useful in some cases.

-}</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Impose a different sampling event on a 'Behavior'.</span><span>
</span><a name="line-252"></a><span class="hs-comment">--</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- The 'Behavior' will have the same values as before, but the event returned</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- by the 'changes' function will now happen simultaneously with the</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- imposed event.</span><span>
</span><a name="line-256"></a><span class="hs-comment">--</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- Note: This function is useful only in very specific circumstances.</span><span>
</span><a name="line-258"></a><span class="hs-identifier">imposeChanges</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453063"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453063"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-259"></a><a name="imposeChanges"><a href="Reactive.Banana.Frameworks.html#imposeChanges"><span class="hs-identifier">imposeChanges</span></a></a><span> </span><a name="local-1627453071"><a href="#local-1627453071"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627453072"><a href="#local-1627453072"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#imposeChanges"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">imposeChanges</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unB</span><span> </span><a href="#local-1627453071"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span> </span><a href="#local-1627453072"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Dynamically add input and output to an existing event network.</span><span>
</span><a name="line-262"></a><span class="hs-comment">--</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- Note: You can even do 'IO' actions here,</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- which is useful if you want to register additional event handlers</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- dynamically.</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- However, there is no</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- guarantee about the order in which the actions are executed.</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- If the result 'Event' of this function is garbage collected,</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- it may also happen that the actions are not executed at all.</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- If you want a reliable way to turn events into 'IO' actions</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- use the 'reactimate' and 'reactimate'' functions.</span><span>
</span><a name="line-272"></a><span class="hs-identifier">execute</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><a href="#local-1627453062"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453062"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-273"></a><a name="execute"><a href="Reactive.Banana.Frameworks.html#execute"><span class="hs-identifier">execute</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#executeE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">executeE</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-identifier">unMIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">-- $liftIO</span><span>
</span><a name="line-276"></a><span class="hs-comment">--</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- &gt; liftIO :: Frameworks t =&gt; IO a -&gt; Moment t a</span><span>
</span><a name="line-278"></a><span class="hs-comment">--</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- Lift an 'IO' action into the 'Moment' monad.</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">-- | Lift an 'IO' action into the 'Moment' monad,</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- but defer its execution until compilation time.</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- This can be useful for recursive definitions using 'MonadFix'.</span><span>
</span><a name="line-284"></a><span class="hs-identifier">liftIOLater</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><a name="liftIOLater"><a href="Reactive.Banana.Frameworks.html#liftIOLater"><span class="hs-identifier">liftIOLater</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#MIO"><span class="hs-identifier hs-var">MIO</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#liftIOLater"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">liftIOLater</span></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-comment">-- | Compile the description of an event network</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- into an 'EventNetwork'</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- that you can 'actuate', 'pause' and so on.</span><span>
</span><a name="line-290"></a><span class="hs-identifier">compile</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Reactive.Banana.Frameworks.html#EventNetwork"><span class="hs-identifier hs-type">EventNetwork</span></a><span>
</span><a name="line-291"></a><a name="compile"><a href="Reactive.Banana.Frameworks.html#compile"><span class="hs-identifier">compile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Frameworks.html#EN"><span class="hs-identifier hs-var">EN</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#compile"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">compile</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unMIO</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Running event networks
------------------------------------------------------------------------------}</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- | Data type that represents a compiled event network.</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- It may be paused or already running.</span><span>
</span><a name="line-298"></a><span class="hs-keyword">newtype</span><span> </span><a name="EventNetwork"><a href="Reactive.Banana.Frameworks.html#EventNetwork"><span class="hs-identifier">EventNetwork</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EN"><a href="Reactive.Banana.Frameworks.html#EN"><span class="hs-identifier">EN</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unEN"><a href="Reactive.Banana.Frameworks.html#unEN"><span class="hs-identifier">unEN</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#EventNetwork"><span class="hs-identifier hs-type">Prim</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">EventNetwork</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">-- | Actuate an event network.</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- The inputs will register their event handlers, so that</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- the networks starts to produce outputs in response to input events.</span><span>
</span><a name="line-303"></a><span class="hs-identifier">actuate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Frameworks.html#EventNetwork"><span class="hs-identifier hs-type">EventNetwork</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><a name="actuate"><a href="Reactive.Banana.Frameworks.html#actuate"><span class="hs-identifier">actuate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">actuate</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unEN</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">-- | Pause an event network.</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- Immediately stop producing output.</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- (In a future version, it will also unregister all event handlers for inputs.)</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- Hence, the network stops responding to input events,</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- but it's state will be preserved.</span><span>
</span><a name="line-311"></a><span class="hs-comment">--</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- You can resume the network with 'actuate'.</span><span>
</span><a name="line-313"></a><span class="hs-comment">--</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- Note: You can stop a network even while it is processing events,</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- i.e. you can use 'pause' as an argument to 'reactimate'.</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- The network will /not/ stop immediately though, only after</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- the current event has been processed completely.</span><span>
</span><a name="line-318"></a><span class="hs-identifier">pause</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Frameworks.html#EventNetwork"><span class="hs-identifier hs-type">EventNetwork</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-319"></a><a name="pause"><a href="Reactive.Banana.Frameworks.html#pause"><span class="hs-identifier">pause</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Prim</span><span class="hs-operator">.</span><span class="hs-identifier">pause</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unEN</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Utilities
------------------------------------------------------------------------------}</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- | Build an 'Event' together with an 'IO' action that can</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- fire occurrences of this event. Variant of 'newAddHandler'.</span><span>
</span><a name="line-326"></a><span class="hs-comment">--</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- This function is mainly useful for passing callback functions</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- inside a 'reactimate'.</span><span>
</span><a name="line-329"></a><span class="hs-identifier">newEvent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453061"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Event.Handler.html#Handler"><span class="hs-identifier hs-type">Handler</span></a><span> </span><a href="#local-1627453061"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><a name="newEvent"><a href="Reactive.Banana.Frameworks.html#newEvent"><span class="hs-identifier">newEvent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-special">(</span><a name="local-1627453073"><a href="#local-1627453073"><span class="hs-identifier">addHandler</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627453074"><a href="#local-1627453074"><span class="hs-identifier">fire</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Event.Handler.html#newAddHandler"><span class="hs-identifier hs-var">newAddHandler</span></a><span>
</span><a name="line-332"></a><span>    </span><a name="local-1627453075"><a href="#local-1627453075"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier hs-var">fromAddHandler</span></a><span> </span><a href="#local-1627453073"><span class="hs-identifier hs-var">addHandler</span></a><span>
</span><a name="line-333"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627453075"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><a href="#local-1627453074"><span class="hs-identifier hs-var">fire</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- | Build a 'Behavior' together with an 'IO' action that can</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- update this behavior with new values.</span><span>
</span><a name="line-337"></a><span class="hs-comment">--</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- Implementation:</span><span>
</span><a name="line-339"></a><span class="hs-comment">--</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- &gt; newBehavior a = do</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- &gt;     (e, fire) &lt;- newEvent</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- &gt;     b         &lt;- stepper a e</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- &gt;     return (b, fire)</span><span>
</span><a name="line-344"></a><span class="hs-identifier">newBehavior</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627453060"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627453060"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Event.Handler.html#Handler"><span class="hs-identifier hs-type">Handler</span></a><span> </span><a href="#local-1627453060"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><a name="newBehavior"><a href="Reactive.Banana.Frameworks.html#newBehavior"><span class="hs-identifier">newBehavior</span></a></a><span> </span><a name="local-1627453076"><a href="#local-1627453076"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-special">(</span><a name="local-1627453077"><a href="#local-1627453077"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627453078"><a href="#local-1627453078"><span class="hs-identifier">fire</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#newEvent"><span class="hs-identifier hs-var">newEvent</span></a><span>
</span><a name="line-347"></a><span>    </span><a name="local-1627453079"><a href="#local-1627453079"><span class="hs-identifier">b</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627453076"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627453077"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-348"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627453079"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627453078"><span class="hs-identifier hs-var">fire</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- | Build a new 'Event' that contains the result</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- of an IO computation.</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- The input and result events will /not/ be simultaneous anymore,</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- the latter will occur /later/ than the former.</span><span>
</span><a name="line-354"></a><span class="hs-comment">--</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- Please use the 'fmap' for 'Event' if your computation is pure.</span><span>
</span><a name="line-356"></a><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- Implementation:</span><span>
</span><a name="line-358"></a><span class="hs-comment">--</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- &gt; mapEventIO f e1 = do</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- &gt;     (e2, handler) &lt;- newEvent</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- &gt;     reactimate $ (\a -&gt; f a &gt;&gt;= handler) &lt;$&gt; e1</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- &gt;     return e2</span><span>
</span><a name="line-363"></a><span class="hs-identifier">mapEventIO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627453058"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1627453059"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453058"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453059"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><a name="mapEventIO"><a href="Reactive.Banana.Frameworks.html#mapEventIO"><span class="hs-identifier">mapEventIO</span></a></a><span> </span><a name="local-1627453080"><a href="#local-1627453080"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627453081"><a href="#local-1627453081"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-365"></a><span>    </span><span class="hs-special">(</span><a name="local-1627453082"><a href="#local-1627453082"><span class="hs-identifier">e2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627453083"><a href="#local-1627453083"><span class="hs-identifier">handler</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#newEvent"><span class="hs-identifier hs-var">newEvent</span></a><span>
</span><a name="line-366"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#reactimate"><span class="hs-identifier hs-var">reactimate</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627453084"><a href="#local-1627453084"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627453080"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627453084"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-1627453083"><span class="hs-identifier hs-var">handler</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627453081"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-367"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627453082"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Simple use
------------------------------------------------------------------------------}</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- | Interpret an event processing function by building an 'EventNetwork'</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- and running it. Useful for testing, but uses 'MomentIO'.</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- See 'interpret' for a plain variant.</span><span>
</span><a name="line-375"></a><span class="hs-identifier">interpretFrameworks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453056"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#MomentIO"><span class="hs-identifier hs-type">MomentIO</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453057"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627453056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627453057"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-376"></a><a name="interpretFrameworks"><a href="Reactive.Banana.Frameworks.html#interpretFrameworks"><span class="hs-identifier">interpretFrameworks</span></a></a><span> </span><a name="local-1627453085"><a href="#local-1627453085"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627453086"><a href="#local-1627453086"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-377"></a><span>    </span><a name="local-1627453087"><a href="#local-1627453087"><span class="hs-identifier">output</span></a></a><span>                    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-special">(</span><a name="local-1627453088"><a href="#local-1627453088"><span class="hs-identifier">addHandler</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627453089"><a href="#local-1627453089"><span class="hs-identifier">runHandlers</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Event.Handler.html#newAddHandler"><span class="hs-identifier hs-var">newAddHandler</span></a><span>
</span><a name="line-379"></a><span>    </span><a name="local-1627453092"><a href="#local-1627453092"><span class="hs-identifier">network</span></a></a><span>                   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#compile"><span class="hs-identifier hs-var">compile</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-380"></a><span>        </span><a name="local-1627453090"><a href="#local-1627453090"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier hs-var">fromAddHandler</span></a><span> </span><a href="#local-1627453088"><span class="hs-identifier hs-var">addHandler</span></a><span>
</span><a name="line-381"></a><span>        </span><a name="local-1627453091"><a href="#local-1627453091"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627453085"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627453090"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-382"></a><span>        </span><a href="Reactive.Banana.Frameworks.html#reactimate"><span class="hs-identifier hs-var">reactimate</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><a href="#local-1627453087"><span class="hs-identifier hs-var">output</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627453091"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#actuate"><span class="hs-identifier hs-var">actuate</span></a><span> </span><a href="#local-1627453092"><span class="hs-identifier hs-var">network</span></a><span>
</span><a name="line-385"></a><span>    </span><a name="local-1627453096"><a href="#local-1627453096"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><a href="#local-1627453086"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627453093"><a href="#local-1627453093"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-386"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627453093"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-387"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-388"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627453094"><a href="#local-1627453094"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-389"></a><span>                </span><a href="#local-1627453089"><span class="hs-identifier hs-var">runHandlers</span></a><span> </span><a href="#local-1627453094"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-390"></a><span>                </span><a name="local-1627453095"><a href="#local-1627453095"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-1627453087"><span class="hs-identifier hs-var">output</span></a><span>
</span><a name="line-391"></a><span>                </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><a href="#local-1627453087"><span class="hs-identifier hs-var">output</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-392"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627453095"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-393"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627453096"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-comment">-- | Simple way to write a single event handler with</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- functional reactive programming.</span><span>
</span><a name="line-397"></a><span class="hs-identifier">interpretAsHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627453055"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Event.Handler.html#AddHandler"><span class="hs-identifier hs-type">AddHandler</span></a><span> </span><a href="#local-1627453054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Event.Handler.html#AddHandler"><span class="hs-identifier hs-type">AddHandler</span></a><span> </span><a href="#local-1627453055"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-398"></a><a name="interpretAsHandler"><a href="Reactive.Banana.Frameworks.html#interpretAsHandler"><span class="hs-identifier">interpretAsHandler</span></a></a><span> </span><a name="local-1627453097"><a href="#local-1627453097"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627453098"><a href="#local-1627453098"><span class="hs-identifier">addHandlerA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Event.Handler.html#AddHandler"><span class="hs-identifier hs-var">AddHandler</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627453099"><a href="#local-1627453099"><span class="hs-identifier">handlerB</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-399"></a><span>    </span><a name="local-1627453102"><a href="#local-1627453102"><span class="hs-identifier">network</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#compile"><span class="hs-identifier hs-var">compile</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-400"></a><span>        </span><a name="local-1627453100"><a href="#local-1627453100"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Frameworks.html#fromAddHandler"><span class="hs-identifier hs-var">fromAddHandler</span></a><span> </span><a href="#local-1627453098"><span class="hs-identifier hs-var">addHandlerA</span></a><span>
</span><a name="line-401"></a><span>        </span><a name="local-1627453101"><a href="#local-1627453101"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627453097"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627453100"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>        </span><a href="Reactive.Banana.Frameworks.html#reactimate"><span class="hs-identifier hs-var">reactimate</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627453099"><span class="hs-identifier hs-var">handlerB</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627453101"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-403"></a><span>    </span><a href="Reactive.Banana.Frameworks.html#actuate"><span class="hs-identifier hs-var">actuate</span></a><span> </span><a href="#local-1627453102"><span class="hs-identifier hs-var">network</span></a><span>
</span><a name="line-404"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Frameworks.html#pause"><span class="hs-identifier hs-var">pause</span></a><span> </span><a href="#local-1627453102"><span class="hs-identifier hs-var">network</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a></pre></body></html>