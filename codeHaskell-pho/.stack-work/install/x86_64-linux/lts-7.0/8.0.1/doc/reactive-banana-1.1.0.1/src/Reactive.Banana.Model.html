<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-----------------------------------------------------------------------------
    reactive-banana
------------------------------------------------------------------------------}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RecursiveDo #-}</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-comment">-- * Synopsis</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-comment">-- | Model implementation for learning and testing.</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- * Overview</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-comment">-- $overview</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-comment">-- * Core Combinators</span><span>
</span><a name="line-13"></a><span>    </span><span class="hs-comment">-- ** Event and Behavior</span><span>
</span><a name="line-14"></a><span>    </span><a href="Reactive.Banana.Model.html#Nat"><span class="hs-identifier hs-type">Nat</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="Reactive.Banana.Model.html#interpret"><span class="hs-identifier hs-var">interpret</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- ** First-order</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="Reactive.Banana.Model.html#never"><span class="hs-identifier hs-var">never</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#unionWith"><span class="hs-identifier hs-var">unionWith</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#filterJust"><span class="hs-identifier hs-var">filterJust</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#apply"><span class="hs-identifier hs-var">apply</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-comment">-- ** Moment and accumulation</span><span>
</span><a name="line-21"></a><span>    </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#accumE"><span class="hs-identifier hs-var">accumE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-comment">-- ** Higher-order</span><span>
</span><a name="line-23"></a><span>    </span><a href="Reactive.Banana.Model.html#valueB"><span class="hs-identifier hs-var">valueB</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#observeE"><span class="hs-identifier hs-var">observeE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#switchE"><span class="hs-identifier hs-var">switchE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Model.html#switchB"><span class="hs-identifier hs-var">switchB</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fix</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-comment">{-$overview

This module reimplements the key FRP types and functions from the module
&quot;Reactive.Banana.Combinators&quot; in a way that is hopefully easier to understand.
Thereby, this model also specifies the semantics of the library.
Of course, the real implementation is much more efficient than this model here.

To understand the model in detail, look at the source code!
(If there is no link to the source code at every type signature,
then you have to run cabal with --hyperlink-source flag.)

This model is /authoritative/:
Event functions that have been constructed using the same combinators
/must/ give the same results when run with the @interpret@ function
from either the module &quot;Reactive.Banana.Combinators&quot;
or the module &quot;Reactive.Banana.Model&quot;.
This must also hold for recursive and partial definitions
(at least in spirit, I'm not going to split hairs over @_|_@ vs @\\_ -&gt; _|_@).

-}</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Event and Behavior
------------------------------------------------------------------------------}</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- | Natural numbers (poorly represented).</span><span>
</span><a name="line-55"></a><span class="hs-keyword">type</span><span> </span><a name="Nat"><a href="Reactive.Banana.Model.html#Nat"><span class="hs-identifier">Nat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | The FRP model used in this library is actually a model with continuous time.</span><span>
</span><a name="line-58"></a><span class="hs-comment">--</span><span>
</span><a name="line-59"></a><span class="hs-comment">-- However, it can be shown that this model is observationally</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- equivalent to a particular model with (seemingly) discrete time steps,</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- which is implemented here.</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- The main reason for doing this is to be able to handle recursion correctly.</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- Details will be explained elsewhere.</span><span>
</span><a name="line-64"></a><span class="hs-keyword">type</span><span> </span><a name="Time"><a href="Reactive.Banana.Model.html#Time"><span class="hs-identifier">Time</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#Nat"><span class="hs-identifier hs-type">Nat</span></a><span> </span><span class="hs-comment">-- begins at t = 0</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- | Event is modeled by an /infinite/ list of 'Maybe' values.</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- It is isomorphic to @Time -&gt; Maybe a@.</span><span>
</span><a name="line-68"></a><span class="hs-comment">--</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- 'Nothing' indicates that no occurrence happens,</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- while 'Just' indicates that an occurrence happens.</span><span>
</span><a name="line-71"></a><span class="hs-keyword">newtype</span><span> </span><a name="Event"><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier">Event</span></a></a><span> </span><a name="local-1627448408"><a href="#local-1627448408"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="E"><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier">E</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unE"><a href="Reactive.Banana.Model.html#unE"><span class="hs-identifier">unE</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448408"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Behavior is modeled by an /infinite/ list of values.</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- It is isomorphic to @Time -&gt; a@.</span><span>
</span><a name="line-75"></a><span class="hs-keyword">newtype</span><span> </span><a name="Behavior"><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier">Behavior</span></a></a><span> </span><a name="local-1627448407"><a href="#local-1627448407"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="B"><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier">B</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unB"><a href="Reactive.Banana.Model.html#unB"><span class="hs-identifier">unB</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-1627448407"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier">interpret</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448423"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448424"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448423"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448424"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-78"></a><a name="interpret"><a href="Reactive.Banana.Model.html#interpret"><span class="hs-identifier">interpret</span></a></a><span> </span><a name="local-1627448425"><a href="#local-1627448425"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448608"><a href="#local-1627448608"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unM</span><span> </span><a href="#local-1627448608"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627448425"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    First-order
------------------------------------------------------------------------------}</span><span>
</span><a name="line-84"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-85"></a><span>    </span><a name="local-805306541"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-1627448665"><a href="#local-1627448665"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><a name="local-1627448666"><a href="#local-1627448666"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627448665"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627448666"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>    </span><a name="local-805306541"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-1627448663"><a href="#local-1627448663"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><a name="local-1627448664"><a href="#local-1627448664"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627448663"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627448664"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>    </span><a name="local-805307120"><span class="hs-identifier">pure</span></a><span> </span><a name="local-1627448660"><a href="#local-1627448660"><span class="hs-identifier">x</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-1627448660"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><a name="local-1627448661"><a href="#local-1627448661"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-805307119"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><a name="local-1627448662"><a href="#local-1627448662"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span class="hs-special">)</span><span> </span><a href="#local-1627448661"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627448662"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-identifier">never</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448422"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-95"></a><a name="never"><a href="Reactive.Banana.Model.html#never"><span class="hs-identifier">never</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-identifier">unionWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448421"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-98"></a><a name="unionWith"><a href="Reactive.Banana.Model.html#unionWith"><span class="hs-identifier">unionWith</span></a></a><span> </span><a name="local-1627448609"><a href="#local-1627448609"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><a name="local-1627448610"><a href="#local-1627448610"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><a name="local-1627448611"><a href="#local-1627448611"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-1627448612"><span class="hs-identifier hs-var">combine</span></a><span> </span><a href="#local-1627448610"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-1627448611"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-100"></a><span>    </span><a name="local-1627448612"><a href="#local-1627448612"><span class="hs-identifier">combine</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448613"><a href="#local-1627448613"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448614"><a href="#local-1627448614"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627448609"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627448613"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627448614"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier">combine</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448615"><a href="#local-1627448615"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627448615"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier">combine</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448616"><a href="#local-1627448616"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627448616"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-identifier">combine</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">filterJust</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448420"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-106"></a><a name="filterJust"><a href="Reactive.Banana.Model.html#filterJust"><span class="hs-identifier">filterJust</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">apply</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627448418"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448419"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448418"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448419"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-109"></a><a name="apply"><a href="Reactive.Banana.Model.html#apply"><span class="hs-identifier">apply</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><a name="local-1627448617"><a href="#local-1627448617"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448618"><a href="#local-1627448618"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627448619"><a href="#local-1627448619"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627448618"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627448619"><span class="hs-identifier hs-var">mx</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627448617"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Moment and accumulation
------------------------------------------------------------------------------}</span><span>
</span><a name="line-114"></a><span class="hs-keyword">newtype</span><span> </span><a name="Moment"><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier">Moment</span></a></a><span> </span><a name="local-1627448406"><a href="#local-1627448406"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="M"><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier">M</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unM"><a href="Reactive.Banana.Model.html#unM"><span class="hs-identifier">unM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Time"><span class="hs-identifier hs-type">Time</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448406"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>     </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-keyword">where</span><span> </span><a name="local-805306541"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-1627448659"><a href="#local-1627448659"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627448659"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unM</span><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>    </span><a name="local-805307120"><span class="hs-identifier">pure</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-special">(</span><a name="local-805307119"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-120"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-121"></a><span>    </span><a name="local-805306542"><span class="hs-identifier">return</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><a name="local-1627448656"><a href="#local-1627448656"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><a name="local-805306539"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-1627448657"><a href="#local-1627448657"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627448658"><a href="#local-1627448658"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unM</span><span> </span><span class="hs-special">(</span><a href="#local-1627448657"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627448656"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1627448658"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627448658"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFix</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>    </span><a name="local-805306543"><span class="hs-identifier">mfix</span></a><span> </span><a name="local-1627448655"><a href="#local-1627448655"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mfix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unM</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627448655"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- Forget all event occurences before a particular time</span><span>
</span><a name="line-128"></a><span class="hs-identifier">forgetE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Time"><span class="hs-identifier hs-type">Time</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448417"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448417"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-129"></a><a name="forgetE"><a href="Reactive.Banana.Model.html#forgetE"><span class="hs-identifier">forgetE</span></a></a><span> </span><a name="local-1627448620"><a href="#local-1627448620"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><a name="local-1627448621"><a href="#local-1627448621"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-1627448620"><span class="hs-identifier hs-var">time</span></a><span> </span><a href="#local-1627448621"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">stepper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627448416"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448416"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448416"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><a name="stepper"><a href="Reactive.Banana.Model.html#stepper"><span class="hs-identifier">stepper</span></a></a><span> </span><a name="local-1627448622"><a href="#local-1627448622"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627448623"><a href="#local-1627448623"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627448630"><a href="#local-1627448630"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-1627448630"><span class="hs-identifier hs-var">time</span></a><span> </span><a href="#local-1627448622"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-1627448624"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-1627448622"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#forgetE"><span class="hs-identifier hs-var">forgetE</span></a><span> </span><a href="#local-1627448630"><span class="hs-identifier hs-var">time</span></a><span> </span><a href="#local-1627448623"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-134"></a><span>    </span><a name="local-1627448624"><a href="#local-1627448624"><span class="hs-identifier">step</span></a></a><span> </span><a name="local-1627448625"><a href="#local-1627448625"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-1627448626"><a href="#local-1627448626"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-1627448627"><a href="#local-1627448627"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627448625"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627448624"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-1627448628"><span class="hs-identifier hs-var">next</span></a><span> </span><a href="#local-1627448627"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-135"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-1627448628"><a href="#local-1627448628"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627448626"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-136"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448629"><a href="#local-1627448629"><span class="hs-identifier">i</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448629"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-137"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448625"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- Expressed using recursion and the other primitives</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- FIXME: Strictness!</span><span>
</span><a name="line-141"></a><span class="hs-identifier">accumE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627448415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627448415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><a name="accumE"><a href="Reactive.Banana.Model.html#accumE"><span class="hs-identifier">accumE</span></a></a><span> </span><a name="local-1627448631"><a href="#local-1627448631"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627448632"><a href="#local-1627448632"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">mdo</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627448633"><a href="#local-1627448633"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448635"><a href="#local-1627448635"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627448636"><a href="#local-1627448636"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448636"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627448635"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627448634"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Reactive.Banana.Model.html#apply"><span class="hs-identifier hs-var">apply</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627448632"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-144"></a><span>    </span><a name="local-1627448634"><a href="#local-1627448634"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Model.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627448631"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627448633"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-145"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627448633"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Higher-order
------------------------------------------------------------------------------}</span><span>
</span><a name="line-150"></a><span class="hs-identifier">valueB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448414"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><a href="#local-1627448414"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-151"></a><a name="valueB"><a href="Reactive.Banana.Model.html#valueB"><span class="hs-identifier">valueB</span></a></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><a name="local-1627448637"><a href="#local-1627448637"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627448638"><a href="#local-1627448638"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448637"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-1627448638"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-identifier">observeE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><a href="#local-1627448413"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448413"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-154"></a><a name="observeE"><a href="Reactive.Banana.Model.html#observeE"><span class="hs-identifier">observeE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448639"><a href="#local-1627448639"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448640"><a href="#local-1627448640"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unM</span><span> </span><a href="#local-1627448640"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-1627448639"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">switchE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448412"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><a name="switchE"><a href="Reactive.Banana.Model.html#switchE"><span class="hs-identifier">switchE</span></a></a><span> </span><a name="local-1627448641"><a href="#local-1627448641"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627448649"><a href="#local-1627448649"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-1627448649"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-1627448642"><span class="hs-identifier hs-var">switch</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span> </span><a href="Reactive.Banana.Model.html#never"><span class="hs-identifier hs-var">never</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#forgetE"><span class="hs-identifier hs-var">forgetE</span></a><span> </span><a href="#local-1627448649"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#forgetDiagonalE"><span class="hs-identifier hs-var">forgetDiagonalE</span></a><span> </span><a href="#local-1627448641"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-1627448642"><a href="#local-1627448642"><span class="hs-identifier">switch</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627448643"><a href="#local-1627448643"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-1627448644"><a href="#local-1627448644"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1627448645"><a href="#local-1627448645"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627448643"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627448642"><span class="hs-identifier hs-var">switch</span></a><span> </span><a href="#local-1627448644"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-1627448645"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-identifier">switch</span><span> </span><span class="hs-special">(</span><a name="local-1627448646"><a href="#local-1627448646"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627448647"><a href="#local-1627448647"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-1627448648"><a href="#local-1627448648"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627448646"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-1627448642"><span class="hs-identifier hs-var">switch</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-1627448647"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627448648"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">forgetDiagonalE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627448411"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627448411"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><a name="forgetDiagonalE"><a href="Reactive.Banana.Model.html#forgetDiagonalE"><span class="hs-identifier">forgetDiagonalE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448650"><a href="#local-1627448650"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#forgetE"><span class="hs-identifier hs-var">forgetE</span></a><span> </span><a href="#local-1627448650"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-identifier">switchB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448410"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448410"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448410"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><a name="switchB"><a href="Reactive.Banana.Model.html#switchB"><span class="hs-identifier">switchB</span></a></a><span> </span><a name="local-1627448651"><a href="#local-1627448651"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627448652"><a href="#local-1627448652"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#diagonalB"><span class="hs-identifier hs-var">diagonalB</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Reactive.Banana.Model.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627448651"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-1627448652"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-identifier">diagonalB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448409"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Model.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627448409"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-170"></a><a name="diagonalB"><a href="Reactive.Banana.Model.html#diagonalB"><span class="hs-identifier">diagonalB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Model.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627448653"><a href="#local-1627448653"><span class="hs-identifier">time</span></a></a><span> </span><a name="local-1627448654"><a href="#local-1627448654"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627448654"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-1627448653"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">unB</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unB</span><span>
</span><a name="line-171"></a></pre></body></html>