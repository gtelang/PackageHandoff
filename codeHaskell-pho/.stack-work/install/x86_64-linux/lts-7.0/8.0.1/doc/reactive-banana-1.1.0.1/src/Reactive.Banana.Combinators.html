<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-----------------------------------------------------------------------------
    reactive-banana
------------------------------------------------------------------------------}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE Rank2Types #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Combinators</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-8"></a><span>    </span><span class="hs-comment">-- * Synopsis</span><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- $synopsis</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-comment">-- * Core Combinators</span><span>
</span><a name="line-12"></a><span>    </span><span class="hs-comment">-- ** Event and Behavior</span><span>
</span><a name="line-13"></a><span>    </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="Reactive.Banana.Combinators.html#interpret"><span class="hs-identifier hs-var">interpret</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- ** First-order</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-comment">-- | This subsections lists the primitive first-order combinators for FRP.</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-comment">-- The 'Functor' and 'Applicative' instances are also part of this,</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- but they are documented at the types 'Event' and 'Behavior'.</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="Reactive.Banana.Combinators.html#never"><span class="hs-identifier hs-var">never</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#unionWith"><span class="hs-identifier hs-var">unionWith</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#filterE"><span class="hs-identifier hs-var">filterE</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><a href="Reactive.Banana.Combinators.html#apply"><span class="hs-identifier hs-var">apply</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- ** Moment and accumulation</span><span>
</span><a name="line-26"></a><span>    </span><a href="Reactive.Banana.Types.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><a href="Reactive.Banana.Combinators.html#accumE"><span class="hs-identifier hs-var">accumE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- ** Recursion</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-comment">-- $recursion</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-comment">-- ** Higher-order</span><span>
</span><a name="line-33"></a><span>    </span><a href="Reactive.Banana.Combinators.html#valueB"><span class="hs-identifier hs-var">valueB</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#valueBLater"><span class="hs-identifier hs-var">valueBLater</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#observeE"><span class="hs-identifier hs-var">observeE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#switchE"><span class="hs-identifier hs-var">switchE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#switchB"><span class="hs-identifier hs-var">switchB</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Derived Combinators</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- ** Infix operators</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">(</span><a href="Reactive.Banana.Combinators.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Combinators.html#%3C%40"><span class="hs-operator hs-var">&lt;@</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-comment">-- ** Filtering</span><span>
</span><a name="line-39"></a><span>    </span><a href="Reactive.Banana.Combinators.html#filterJust"><span class="hs-identifier hs-var">filterJust</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#filterApply"><span class="hs-identifier hs-var">filterApply</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#whenE"><span class="hs-identifier hs-var">whenE</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#split"><span class="hs-identifier hs-var">split</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- ** Accumulation</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-comment">-- $Accumulation.</span><span>
</span><a name="line-42"></a><span>    </span><a href="Reactive.Banana.Combinators.html#unions"><span class="hs-identifier hs-var">unions</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#accumB"><span class="hs-identifier hs-var">accumB</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#mapAccum"><span class="hs-identifier hs-var">mapAccum</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Combinators</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Prim</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><a href="Reactive.Banana.Types.html"><span class="hs-identifier">Reactive</span><span class="hs-operator">.</span><span class="hs-identifier">Banana</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Introduction
------------------------------------------------------------------------------}</span><span>
</span><a name="line-56"></a><span class="hs-comment">{-$synopsis

The main types and combinators of Functional Reactive Programming (FRP).

At its core, FRP is about two data types 'Event' and 'Behavior'
and the various ways to combine them.
There is also a third type 'Moment',
which is necessary for the higher-order combinators.

-}</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- Event</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- Behavior</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Interpetation
------------------------------------------------------------------------------}</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- | Interpret an event processing function.</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- Useful for testing.</span><span>
</span><a name="line-75"></a><span class="hs-comment">--</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- Note: You can safely assume that this function is pure,</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- even though the type seems to suggest otherwise.</span><span>
</span><a name="line-78"></a><span class="hs-comment">-- I'm really sorry about the extra 'IO', but it can't be helped.</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- See source code for the sordid details.</span><span>
</span><a name="line-80"></a><span class="hs-identifier">interpret</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452140"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452141"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627452140"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627452141"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-81"></a><a name="interpret"><a href="Reactive.Banana.Combinators.html#interpret"><span class="hs-identifier">interpret</span></a></a><span> </span><a name="local-1627452142"><a href="#local-1627452142"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627452143"><a href="#local-1627452143"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#interpret"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">interpret</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unE</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unM</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627452142"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627452143"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- FIXME: I would love to remove the 'IO' from the type signature,</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- but unfortunately, it is possible that the argument to interpret</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- returns an Event that was created in the context of an existing network, e.g.</span><span>
</span><a name="line-85"></a><span class="hs-comment">--</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- &gt;   eBad &lt;- fromAddHandler ...</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- &gt;   ...</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- &gt;   let ys = interpret (\_ -&gt; return eBad ) xs</span><span>
</span><a name="line-89"></a><span class="hs-comment">--</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- Doing this is a big no-no and will break a lot of things,</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- but if we remove the 'IO' here, then we will also break referential</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- transparency, and I think that takes it too far.</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Core combinators
------------------------------------------------------------------------------}</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- | Event that never occurs.</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-99"></a><span class="hs-comment">--</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- &gt; never = []</span><span>
</span><a name="line-101"></a><span class="hs-identifier">never</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452139"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-102"></a><a name="never"><a href="Reactive.Banana.Combinators.html#never"><span class="hs-identifier">never</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><a href="Reactive.Banana.Internal.Combinators.html#never"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">never</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Merge two event streams of the same type.</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- The function argument specifies how event values are to be combined</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- in case of a simultaneous occurrence. The semantics are</span><span>
</span><a name="line-107"></a><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- &gt; unionWith f ((timex,x):xs) ((timey,y):ys)</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- &gt;    | timex &lt;  timey = (timex,x)     : unionWith f xs ((timey,y):ys)</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- &gt;    | timex &gt;  timey = (timey,y)     : unionWith f ((timex,x):xs) ys</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- &gt;    | timex == timey = (timex,f x y) : unionWith f xs ys</span><span>
</span><a name="line-112"></a><span class="hs-identifier">unionWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452138"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-113"></a><a name="unionWith"><a href="Reactive.Banana.Combinators.html#unionWith"><span class="hs-identifier">unionWith</span></a></a><span> </span><a name="local-1627452144"><a href="#local-1627452144"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627452145"><a href="#local-1627452145"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-1627452146"><a href="#local-1627452146"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#unionWith"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">unionWith</span></a><span> </span><a href="#local-1627452144"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span> </span><a href="#local-1627452145"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span> </span><a href="#local-1627452146"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | Allow all event occurrences that are 'Just' values, discard the rest.</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- Variant of 'filterE'.</span><span>
</span><a name="line-117"></a><span class="hs-identifier">filterJust</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627452137"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452137"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-118"></a><a name="filterJust"><a href="Reactive.Banana.Combinators.html#filterJust"><span class="hs-identifier">filterJust</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#filterJust"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filterJust</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- | Allow all events that fulfill the predicate, discard the rest.</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-122"></a><span class="hs-comment">--</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- &gt; filterE p es = [(time,a) | (time,a) &lt;- es, p a]</span><span>
</span><a name="line-124"></a><span class="hs-identifier">filterE</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627452136"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452136"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452136"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-125"></a><a name="filterE"><a href="Reactive.Banana.Combinators.html#filterE"><span class="hs-identifier">filterE</span></a></a><span> </span><a name="local-1627452147"><a href="#local-1627452147"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Combinators.html#filterJust"><span class="hs-identifier hs-var">filterJust</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627452148"><a href="#local-1627452148"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627452147"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627452148"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627452148"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | Apply a time-varying function to a stream of events.</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- &gt; apply bf ex = [(time, bf time x) | (time, x) &lt;- ex]</span><span>
</span><a name="line-131"></a><span class="hs-comment">--</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- This function is generally used in its infix variant '&lt;@&gt;'.</span><span>
</span><a name="line-133"></a><span class="hs-identifier">apply</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452134"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452135"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452134"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452135"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-134"></a><a name="apply"><a href="Reactive.Banana.Combinators.html#apply"><span class="hs-identifier">apply</span></a></a><span> </span><a name="local-1627452149"><a href="#local-1627452149"><span class="hs-identifier">bf</span></a></a><span> </span><a name="local-1627452150"><a href="#local-1627452150"><span class="hs-identifier">ex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#applyE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">applyE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unB</span><span> </span><a href="#local-1627452149"><span class="hs-identifier hs-var">bf</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span> </span><a href="#local-1627452150"><span class="hs-identifier hs-var">ex</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Construct a time-varying function from an initial value and</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- a stream of new values. The result will be a step function.</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-139"></a><span class="hs-comment">--</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- &gt; stepper x0 ex = \time1 -&gt; \time2 -&gt;</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- &gt;     last (x0 : [x | (timex,x) &lt;- ex, time1 &lt;= timex, timex &lt; time2])</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- Here is an illustration of the result Behavior at a particular time:</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- &lt;&lt;doc/frp-stepper.png&gt;&gt;</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- Note: The smaller-than-sign in the comparison @timex &lt; time2@ means</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- that at time @time2 == timex@, the value of the Behavior will</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- still be the previous value.</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- In the illustration, this is indicated by the dots at the end</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- of each step.</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- This allows for recursive definitions.</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- See the discussion below for more on recursion.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">stepper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452132"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627452133"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452133"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452132"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452133"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="stepper"><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier">stepper</span></a></a><span> </span><a name="local-1627452151"><a href="#local-1627452151"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#stepperB"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">stepperB</span></a><span> </span><a href="#local-1627452151"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | The 'accumE' function accumulates a stream of event values,</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- similar to a /strict/ left scan, 'scanl''.</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- It starts with an initial value and emits a new value</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- whenever an event occurrence happens.</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- The new value is calculated by applying the function in the event</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- to the old value.</span><span>
</span><a name="line-163"></a><span class="hs-comment">--</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-165"></a><span class="hs-comment">--</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- &gt; accumE &quot;x&quot; [(time1,(++&quot;y&quot;)),(time2,(++&quot;z&quot;))]</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- &gt;     = trimE [(time1,&quot;xy&quot;),(time2,&quot;xyz&quot;)]</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- &gt;     where</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- &gt;     trimE e start = [(time,x) | (time,x) &lt;- e, start &lt;= time]</span><span>
</span><a name="line-170"></a><span class="hs-identifier">accumE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452130"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627452131"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452131"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452131"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452130"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452131"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><a name="accumE"><a href="Reactive.Banana.Combinators.html#accumE"><span class="hs-identifier">accumE</span></a></a><span> </span><a name="local-1627452152"><a href="#local-1627452152"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#accumE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">accumE</span></a><span> </span><a href="#local-1627452152"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">{-$recursion

/Recursion/ is a very important technique in FRP that is not apparent
from the type signatures.

Here is a prototypical example. It shows how the 'accumE' can be expressed
in terms of the 'stepper' and 'apply' functions by using recursion:

&gt; accumE a e1 = mdo
&gt;    let e2 = (\a f -&gt; f a) &lt;$&gt; b &lt;@&gt; e1
&gt;    b &lt;- stepper a e2
&gt;    return e2

(The @mdo@ notation refers to /value recursion/ in a monad.
The 'MonadFix' instance for the 'Moment' class enables this kind of recursive code.)
(Strictly speaking, this also means that 'accumE' is not a primitive,
because it can be expressed in terms of other combinators.)

This general pattern appears very often in practice:
A Behavior (here @b@) controls what value is put into an Event (here @e2@),
but at the same time, the Event contributes to changes in this Behavior.
Modeling this situation requires recursion.

For another example, consider a vending machine that sells banana juice.
The amount that the customer still has to pay for a juice
is modeled by a Behavior @bAmount@.
Whenever the customer inserts a coin into the machine,
an Event @eCoin@ occurs, and the amount will be reduced.
Whenver the amount goes below zero, an Event @eSold@ will occur,
indicating the release of a bottle of fresh banana juice,
and the amount to be paid will be reset to the original price.
The model requires recursion, and can be expressed in code as follows:

&gt; mdo
&gt;     let price = 50 :: Int
&gt;     bAmount  &lt;- accumB price $ unions
&gt;                   [ subtract 10 &lt;$ eCoin
&gt;                   , const price &lt;$ eSold ]
&gt;     let eSold = whenE ((&lt;= 0) &lt;$&gt; bAmount) eCoin

On one hand, the Behavior @bAmount@ controls whether the Event @eSold@
occcurs at all; the bottle of banana juice is unavailable to penniless customers.
But at the same time, the Event @eSold@ will cause a reset
of the Behavior @bAmount@, so both depend on each other.

Recursive code like this examples works thanks to the semantics of 'stepper'.
In general, /mutual recursion/ between several 'Event's and 'Behavior's
is always well-defined,
as long as an Event depends on itself only /via/ a Behavior,
and vice versa.

-}</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-comment">-- | Obtain the value of the 'Behavior' at a given moment in time.</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- Semantically, it corresponds to</span><span>
</span><a name="line-228"></a><span class="hs-comment">--</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- &gt; valueB b = \time -&gt; b time</span><span>
</span><a name="line-230"></a><span class="hs-comment">--</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- Note: The value is immediately available for pattern matching.</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- Unfortunately, this means that @valueB@ is unsuitable for use</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- with value recursion in the 'Moment' monad.</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- If you need recursion, please use 'valueBLater' instead.</span><span>
</span><a name="line-235"></a><span class="hs-identifier">valueB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452128"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452129"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452128"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627452129"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-236"></a><a name="valueB"><a href="Reactive.Banana.Combinators.html#valueB"><span class="hs-identifier">valueB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#valueB"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">valueB</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unB</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">-- | Obtain the value of the 'Behavior' at a given moment in time.</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- Semantically, it corresponds to</span><span>
</span><a name="line-240"></a><span class="hs-comment">--</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- &gt; valueBLater b = \time -&gt; b time</span><span>
</span><a name="line-242"></a><span class="hs-comment">--</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- Note: To allow for more recursion, the value is returned /lazily/</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- and not available for pattern matching immediately.</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- It can be used safely with most combinators like 'stepper'.</span><span>
</span><a name="line-246"></a><span class="hs-comment">-- If that doesn't work for you, please use 'valueB' instead.</span><span>
</span><a name="line-247"></a><span class="hs-identifier">valueBLater</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452126"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452127"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452126"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627452127"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-248"></a><a name="valueBLater"><a href="Reactive.Banana.Combinators.html#valueBLater"><span class="hs-identifier">valueBLater</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#initialBLater"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">initialBLater</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unB</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Observe a value at those moments in time where</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- event occurrences happen. Semantically,</span><span>
</span><a name="line-253"></a><span class="hs-comment">--</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- &gt; observeE e = [(time, m time) | (time, m) &lt;- e]</span><span>
</span><a name="line-255"></a><span class="hs-identifier">observeE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Moment"><span class="hs-identifier hs-type">Moment</span></a><span> </span><a href="#local-1627452125"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452125"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-256"></a><a name="observeE"><a href="Reactive.Banana.Combinators.html#observeE"><span class="hs-identifier">observeE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#observeE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">observeE</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-identifier">unM</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- | Dynamically switch between 'Event'.</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-260"></a><span class="hs-comment">--</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- &gt; switchE ee = \time0 -&gt; concat [trim t1 t2 e | (t1,t2,e) &lt;- intervals ee, time0 &lt;= t1]</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- &gt;     where</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- &gt;     intervals e        = [(time1, time2, x) | ((time1,x),(time2,_)) &lt;- zip e (tail e)]</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- &gt;     trim time1 time2 e = [x | (timex,x) &lt;- e, time1 &lt; timex, timex &lt;= time2]</span><span>
</span><a name="line-265"></a><span class="hs-identifier">switchE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452123"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452124"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452123"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452124"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><a name="switchE"><a href="Reactive.Banana.Combinators.html#switchE"><span class="hs-identifier">switchE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#E"><span class="hs-identifier hs-var">E</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#switchE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">switchE</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unE</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-comment">-- | Dynamically switch between 'Behavior'.</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- Semantically,</span><span>
</span><a name="line-270"></a><span class="hs-comment">--</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- &gt;  switchB b0 eb = \time0 -&gt; \time1 -&gt;</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- &gt;     last (b0 : [b | (timeb,b) &lt;- eb, time0 &lt;= timeb, timeb &lt; time1]) time1</span><span>
</span><a name="line-273"></a><span class="hs-identifier">switchB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452121"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452122"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452122"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452121"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452122"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><a name="switchB"><a href="Reactive.Banana.Combinators.html#switchB"><span class="hs-identifier">switchB</span></a></a><span> </span><a name="local-1627452153"><a href="#local-1627452153"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Types.html#liftMoment"><span class="hs-identifier hs-var">liftMoment</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Types.html#M"><span class="hs-identifier hs-var">M</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Reactive.Banana.Types.html#B"><span class="hs-identifier hs-var">B</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#switchB"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">switchB</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unB</span><span> </span><a href="#local-1627452153"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Internal.Combinators.html#mapE"><span class="hs-identifier hs-var">Prim</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapE</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unB</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unE</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">{-----------------------------------------------------------------------------
    Derived Combinators
------------------------------------------------------------------------------}</span><span>
</span><a name="line-279"></a><span class="hs-comment">{-

Unfortunately, we can't make a  Num  instance because that would
require  Eq  and  Show .

instance Num a =&gt; Num (Behavior t a) where
    (+) = liftA2 (+)
    (-) = liftA2 (-)
    (*) = liftA2 (*)
    negate = fmap negate
    abs    = fmap abs
    signum = fmap signum
    fromInteger = pure . fromInteger
-}</span><span>
</span><a name="line-293"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator">&lt;@&gt;</span><span class="hs-special">,</span><span> </span><span class="hs-operator">&lt;@</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">-- | Infix synonym for the 'apply' combinator. Similar to '&lt;*&gt;'.</span><span>
</span><a name="line-296"></a><span class="hs-comment">--</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- &gt; infixl 4 &lt;@&gt;</span><span>
</span><a name="line-298"></a><span class="hs-special">(</span><span class="hs-operator">&lt;@&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452119"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452120"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452119"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452120"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-299"></a><span class="hs-special">(</span><a name="%3C%40%3E"><a href="Reactive.Banana.Combinators.html#%3C%40%3E"><span class="hs-operator">&lt;@&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Combinators.html#apply"><span class="hs-identifier hs-var">apply</span></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- | Tag all event occurrences with a time-varying value. Similar to '&lt;*'.</span><span>
</span><a name="line-302"></a><span class="hs-comment">--</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- &gt; infixl 4 &lt;@</span><span>
</span><a name="line-304"></a><span class="hs-special">(</span><span class="hs-operator">&lt;@</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452117"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452118"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452117"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-305"></a><a name="local-1627452154"><a href="#local-1627452154"><span class="hs-identifier">f</span></a></a><span> </span><a name="%3C%40"><a href="Reactive.Banana.Combinators.html#%3C%40"><span class="hs-operator">&lt;@</span></a></a><span> </span><a name="local-1627452155"><a href="#local-1627452155"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452154"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="Reactive.Banana.Combinators.html#%3C%40%3E"><span class="hs-operator hs-var">&lt;@&gt;</span></a><span> </span><a href="#local-1627452155"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- | Allow all events that fulfill the time-varying predicate, discard the rest.</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- Generalization of 'filterE'.</span><span>
</span><a name="line-309"></a><span class="hs-identifier">filterApply</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452116"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452116"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452116"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-310"></a><a name="filterApply"><a href="Reactive.Banana.Combinators.html#filterApply"><span class="hs-identifier">filterApply</span></a></a><span> </span><a name="local-1627452156"><a href="#local-1627452156"><span class="hs-identifier">bp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Combinators.html#filterE"><span class="hs-identifier hs-var">filterE</span></a><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Reactive.Banana.Combinators.html#apply"><span class="hs-identifier hs-var">apply</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627452157"><a href="#local-1627452157"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627452158"><a href="#local-1627452158"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627452157"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627452158"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><a href="#local-1627452158"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452156"><span class="hs-identifier hs-var">bp</span></a><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- | Allow events only when the behavior is 'True'.</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- Variant of 'filterApply'.</span><span>
</span><a name="line-314"></a><span class="hs-identifier">whenE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452115"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452115"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-315"></a><a name="whenE"><a href="Reactive.Banana.Combinators.html#whenE"><span class="hs-identifier">whenE</span></a></a><span> </span><a name="local-1627452159"><a href="#local-1627452159"><span class="hs-identifier">bf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Combinators.html#filterApply"><span class="hs-identifier hs-var">filterApply</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452159"><span class="hs-identifier hs-var">bf</span></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">-- | Split event occurrences according to a tag.</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- The 'Left' values go into the left component while the 'Right' values</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- go into the right component of the result.</span><span>
</span><a name="line-320"></a><span class="hs-identifier">split</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-1627452113"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627452114"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452113"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452114"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-321"></a><a name="split"><a href="Reactive.Banana.Combinators.html#split"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-1627452160"><a href="#local-1627452160"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Combinators.html#filterJust"><span class="hs-identifier hs-var">filterJust</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627452161"><span class="hs-identifier hs-var">fromLeft</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452160"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Combinators.html#filterJust"><span class="hs-identifier hs-var">filterJust</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627452162"><span class="hs-identifier hs-var">fromRight</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452160"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-323"></a><span>    </span><a name="local-1627452161"><a href="#local-1627452161"><span class="hs-identifier">fromLeft</span></a></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-1627452163"><a href="#local-1627452163"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627452163"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-324"></a><span>    </span><span class="hs-identifier">fromLeft</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627452164"><a href="#local-1627452164"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-325"></a><span>    </span><a name="local-1627452162"><a href="#local-1627452162"><span class="hs-identifier">fromRight</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-1627452165"><a href="#local-1627452165"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-identifier">fromRight</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627452166"><a href="#local-1627452166"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627452166"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- $Accumulation.</span><span>
</span><a name="line-330"></a><span class="hs-comment">-- Note: All accumulation functions are strict in the accumulated value!</span><span>
</span><a name="line-331"></a><span class="hs-comment">--</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- Note: The order of arguments is @acc -&gt; (x,acc)@</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- which is also the convention used by 'unfoldr' and 'State'.</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- | Merge event streams whose values are functions.</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- In case of simultaneous occurrences, the functions at the beginning</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- of the list are applied /after/ the functions at the end.</span><span>
</span><a name="line-338"></a><span class="hs-comment">--</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- &gt; unions [] = never</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- &gt; unions xs = foldr1 (unionWith (.)) xs</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- Very useful in conjunction with accumulation functions like 'accumB'</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- and 'accumE'.</span><span>
</span><a name="line-344"></a><span class="hs-identifier">unions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452112"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452112"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452112"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452112"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><a name="unions"><a href="Reactive.Banana.Combinators.html#unions"><span class="hs-identifier">unions</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Combinators.html#never"><span class="hs-identifier hs-var">never</span></a><span>
</span><a name="line-346"></a><span class="hs-identifier">unions</span><span> </span><a name="local-1627452167"><a href="#local-1627452167"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr1</span><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Combinators.html#unionWith"><span class="hs-identifier hs-var">unionWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627452167"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | The 'accumB' function accumulates event occurrences into a 'Behavior'.</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- The value is accumulated using 'accumE' and converted</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- into a time-varying value using 'stepper'.</span><span>
</span><a name="line-352"></a><span class="hs-comment">--</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- Example:</span><span>
</span><a name="line-354"></a><span class="hs-comment">--</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- &gt; accumB &quot;x&quot; [(time1,(++&quot;y&quot;)),(time2,(++&quot;z&quot;))]</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- &gt;    = stepper &quot;x&quot; [(time1,&quot;xy&quot;),(time2,&quot;xyz&quot;)]</span><span>
</span><a name="line-357"></a><span class="hs-comment">--</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- Note: As with 'stepper', the value of the behavior changes \&quot;slightly after\&quot;</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- the events occur. This allows for recursive definitions.</span><span>
</span><a name="line-360"></a><span class="hs-identifier">accumB</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452110"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627452111"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452111"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452111"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452110"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452111"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><a name="accumB"><a href="Reactive.Banana.Combinators.html#accumB"><span class="hs-identifier">accumB</span></a></a><span> </span><a name="local-1627452168"><a href="#local-1627452168"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-1627452169"><a href="#local-1627452169"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627452168"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Reactive.Banana.Combinators.html#accumE"><span class="hs-identifier hs-var">accumE</span></a><span> </span><a href="#local-1627452168"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-1627452169"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- | Efficient combination of 'accumE' and 'accumB'.</span><span>
</span><a name="line-364"></a><span class="hs-identifier">mapAccum</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reactive.Banana.Types.html#MonadMoment"><span class="hs-identifier hs-type">MonadMoment</span></a><span> </span><a href="#local-1627452107"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627452108"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627452108"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627452109"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><a href="#local-1627452108"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627452107"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Reactive.Banana.Types.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><a href="#local-1627452109"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">,</span><span> </span><a href="Reactive.Banana.Types.html#Behavior"><span class="hs-identifier hs-type">Behavior</span></a><span> </span><a href="#local-1627452108"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">)</span><span>
</span><a name="line-365"></a><a name="mapAccum"><a href="Reactive.Banana.Combinators.html#mapAccum"><span class="hs-identifier">mapAccum</span></a></a><span> </span><a name="local-1627452170"><a href="#local-1627452170"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-1627452171"><a href="#local-1627452171"><span class="hs-identifier">ef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-366"></a><span>        </span><a name="local-1627452175"><a href="#local-1627452175"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Combinators.html#accumE"><span class="hs-identifier hs-var">accumE</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span class="hs-special">,</span><a href="#local-1627452170"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627452172"><span class="hs-identifier hs-var">lift</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452171"><span class="hs-identifier hs-var">ef</span></a><span class="hs-special">)</span><span>
</span><a name="line-367"></a><span>        </span><a name="local-1627452176"><a href="#local-1627452176"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Reactive.Banana.Combinators.html#stepper"><span class="hs-identifier hs-var">stepper</span></a><span> </span><a href="#local-1627452170"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452175"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627452175"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627452176"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-370"></a><span>    </span><a name="local-1627452172"><a href="#local-1627452172"><span class="hs-identifier">lift</span></a></a><span> </span><a name="local-1627452173"><a href="#local-1627452173"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-1627452174"><a href="#local-1627452174"><span class="hs-identifier">acc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627452174"><span class="hs-identifier hs-var">acc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-1627452173"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627452174"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-371"></a></pre></body></html>